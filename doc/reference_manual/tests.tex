% Copyright (C) 2007 Technical University of Liberec.  All rights reserved.
%
% Please make a following refer to Flow123d on your project site if you use the program for any purpose,
% especially for academic research:
% Flow123d, Research Centre: Advanced Remedial Technologies, Technical University of Liberec, Czech Republic
%
% This program is free software; you can redistribute it and/or modify it under the terms
% of the GNU General Public License version 3 as published by the Free Software Foundation.
%
% This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
% without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
% See the GNU General Public License for more details.
%
% You should have received a copy of the GNU General Public License along with this program; if not,
% write to the Free Software Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 021110-1307, USA.

\chapter{Units}
\begin{table}
  \label{tab:units}
  \begin{center}
    \begin{tabular}{|l|c|}
      \hline
      \textbf{Quantity} & \textbf{Unit} \\
      \hline 
      lenght & $L$ \\
      time & $T$ \\
      conductivity & $ $ \\
      concentration & $ $ \\
      diffusivity & $ $ \\
      \hline
    \end{tabular}
  \caption{The table of units used in the document.}
  \end{center}
\end{table}

\chapter{Tests}
\label{sec:tests}

\section{Test 01 -- Steady flow}
\label{sec:test01}
This test considers steady Darcy flow in a cube domain which is cutted by fractures so the multidimensional connections is involved in the computation. Dirichlet boundary condition is defined for flow.

\subsection*{Geometry}
A cube with its side 1.0~$L$ is cutted by two diagonal 2D fractures which are further separated by a~1D channel in their cross section.

Geometry parameters are defined for physical domains. Thickness of the 2D fractures is set to 1.0~$L$ and the area of the cross section is set to 1.0~$L^2$. These parameters are unrealistic (the side of the cube is 1.0~$L$ long) but it is compensated in the equation in the fraction with conductivity.

There are only simple Dirichlet boundary conditions. Pressure gradient in direction from one corner of the cube to the oposite corner is applied on all boundary faces of all dimensions.

\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Cross section area:} 1D channel is set to 1.0~$L^2$.
  \item \textbf{Thickness:} 2D fractures are set to 1.0~$L$.
  \item \textbf{Conductivity:} The conductivity of materials:
    \begin{itemize}
      \item 1D channel is set to $K=10$.
      \item 2D fractures are set to $\mathbf{K}=\left(\begin{array}{cc} 1 & 0 \\ 0 & 1\end{array} \right)$.
      \item cube material is set to $\mathbf{K}=\left(\begin{array}{ccc} 0.1 & 0 & 0 \\ 0 & 0.1 & 0 \\ 0 & 0 & 0.1\end{array} \right)$.
    \end{itemize}
  \item There is no transport so there are not any other parameters.
\end{itemize}

\subsection*{Verification}
This test verifies solving steady Darcy flow by mixed hybrid method. There are different dimensional connections which are 2D-3D connection between the cube and the flat fractures and 1D-2D connection between the 1D channel and the two flat fractures in their crossection.

After Schur complements are computed the set of linear equations is solved by CG solver used from PETSC library.



%- parallel sover using PCASM - overlaping domain decomposition

%I don't so...
%- input/output of GMSH when intput mesh has nonstandard numbering of nodes (0,1,3,...)


\section{Test 02 -- Steady flow in 2D and transport}
\label{sec:test02}
This test involves steady Darcy flow in 2D, connections of 1D-2D elements, Dirichlet boundary condition for flow and transport, transport of two substances without initial condition for concentration. Other features are used in explicit transport -- convection, dual porosity and sorption; in implicit transport it is convection and dispersion.

\subsection*{Geometry}
The domain is two-dimensional slice through a part of a relief which involves several one-dimensional cracks.

Simple Dirichlet flow boundary condition is defined on left and right side where pressure heads are prescribed. There is no flow through the upper and lower boundary of the model. This all causes a flow along the x axis.

Dirichlet boundary condition for transport is prescribed on both sides as it is for flow boundary condition. The value of concentration is 1.0 for both substances. Initial concentration of the substances is zero in the whole area. 

\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Cross section area:} 1D fractures are set to 1.0~$L^2$.
  \item \textbf{Thickness:} domain is set to 1.0~$L$.
  \item \textbf{Conductivity:} The conductivity of materials:
    \begin{itemize}
      \item fracture material is set to $K=10$.
      \item plane material is set to $\mathbf{K}=\left(\begin{array}{cc} 1 & 0 \\ 0 & 1\end{array} \right)$.
    \end{itemize}
  \item \textbf{Sorption:} The sorption parameters are for both materials equal:
    \begin{itemize}
      \item linear sorption isotherm parameter of the first substance is set to $k_d=0.02$.
      \item Freundlich sorption isotherm parameters of the second substance are set to $k_f=0.02$, $\alpha=0.5$  
    \end{itemize}
  \item \textbf{Dual porosity:} The dual porosity parameters are for both materials equal:
    \begin{itemize}
      \item mobile porosity coefficient is set to $0.25$
      \item immobile porosity coefficient is set to $0.25$
      \item nonequilibrium coefficient of both substances $0.01$
    \end{itemize}
  \item \textbf{Sorption fraction:} The sorption fraction parameters are for both materials equal and set to $SF=0.5$.
  \item \textbf{Diffusivity coefficient:} These are not set so default values are applied 
	$\sigma=0$, $\alpha_l=0$, $\alpha_t=0$, $d_m=1e-6$.
\end{itemize}

\subsection*{Verification}
This test verifies explicitly computed transport considering only convection with dual porosity and sorption and implicitly computed transport considering both convection and dispersion. Flow and transport through 1D-2D connection is also involved.
%verification of:
%-flow
%-explicit transport (convection, dual porosity, sorption)
%-implicit transport (convection, dispersion)
%-multidimensional connection (1D-2D)


\section{Test 03 -- Steady flow in 2D and transport}
\label{sec:test03}
This test differs from the previous one only by simpler structure of its geometry. It shows how the substace flows in the main fracture and divides in two other fractures. The substance spreads in the fractures much faster in comparision to the plane.
\subsection*{Geometry}
There is a plane with side 1.0 which is cutted by fractures. The main fracture divides in two other fractures.
\subsection*{Parameters}
Parameters are the same as in test 02.
\subsection*{Verification}

%Test problem 3 (variant of problem 2 with simpler geometry)
%---------------------
%verification of:
%-flow
%-explicit transport (convection, dual porosity, sorption)
%-implicit transport (convection, dispersion)
%-multidimensional connection (1D-2D)


\section{Test 08 -- Steady Darcy flow with source}
\label{sec:test08}
This test is aimed at verifying steady Darcy flow with source which is prescribed by space function formula. This formula is processed by the function parser.

We will solve Laplace equation $-\Lapl{}u = f$ where source $f$ is prescribed by function: $f = 2(1-y^2) + 2(1-x^2)$.

We can easily prove that the analytic solution is $u = (1-x^2)(1-y^2)$ by replacing it in the Laplace equation.

\subsection*{Geometry}
The domain is a square with opposite corner points $[-1,-1]$ and $[1,1]$. Zero dirichlet boundary condition is prescribed on all boundaries -- along the circumference of the square.
 
\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Conductivity:} The conductivity of plane material is $1.0$.
  \item There are no other materials, no transport so there are not any other parameters.
\end{itemize}

\subsection*{Verification}
As it was mentioned above, this test mainly verifies that the function parser works properly. The source formula to be parsed is given in the key \verb0source_formula0. The solution (pressure) is a paraboloid with a top in $[0,0,1]$.


\section{Test 12 -- Radioactive decay}
There are actually two tests of the radioactive decay. The first one considers first order reaction of two isotopes determined by kinetic constant and the other one describes radioactive decay chain of three isotopes.

\subsection*{Geometry}
The domain is a prism which base is a right-angled triangle with its ordinates 3.0 units long. There are then only three tetrahedron elements in the mesh.

There are two Dirichlet boundary conditions prescribed.

\begin{itemize}
  \item \textbf{Conductivity:} The conductivity of the prism material is $0.01$. 
  \item There is no other parameter for flow or transport.
\end{itemize}


 
\subsection{First order reaction determined by kinetic constant}
The only linear reaction between D and F substances.
\[
D\xrightarrow{k}F
\]

\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Substances:} 6 substances to be transported -- A, B, C, D, E, F
  \item \textbf{Kinetic constant:} $k = 0.277258872$
\end{itemize}

\subsection*{Verification}

\subsection{Radioactive decay chain}
The considered radioctive decay chain is:
\[
 D\xrightarrow{t_{1/2,D}}F\xrightarrow{t_{1/2,F}}B
\]
\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Substances:} 6 substances to be transported -- A, B, C, D, E, F
  \item \textbf{Decay half-lives:} $t_{1/2,D} = t_{1/2,F} = 2.5$
\end{itemize}

\subsection*{Verification}

% Both following tests are realized without combination with transport (zero pressure gradient).
% verification of:
% - first order reaction A->B determined by kinetic constant,
% -- 6 chemical species (A, B, .., F) are transported but just 2 of them take a part in considered first order kinetic reaction wich looks as follows
% --- D->F, appropriate kinetic constant is k = 0.277258872.
% --- Initail conditions look as follows, A(0) = 0.01, B(0) = 0.02, C(0) = 0.03, D(0) = 0.04, E(0) = 0.05, F(0) = 0.06.
% --- Transport boundary conditions does not matter because zero presure gradient is considered.
% --- Final concentrations of all isotopes except A, B, C, E do not change. Concentrations of D decreases to 0.003. Concentration of F increase to 0.85 in 20 time steps.

% - narrow radioctive decay chain without branches, A -> B -> C,
% -- 6 isotopes (A, B, .., F) are transported but just 3 of them are members of considered decay chain which looks as folows
% --- D->F->B
% --- Initail conditions look as follows, A(0) = 0.01, B(0) = 0.02, C(0) = 0.03, D(0) = 0.04, E(0) = 0.05, F(0) = 0.06.
% --- Transport boundary conditions does not matter because zero presure gradient is considered.
% --- Final concentrations of all isotopes except A, C, E do not change. Concentrations of D and B decrease to 0.004 and 0.012 respectively. Concentration of B increase to 0.1 in 20 time steps.


\section{Test 17 -- Radioactive decay -- Pade approximation}
This test solves radioactive decay chain of five isotopes using Pade approximation.
The considered radioctive decay chain is:
\[
 A\xrightarrow{t_{1/2,A}}B\xrightarrow{t_{1/2,B}}C\xrightarrow{t_{1/2,C}}D\xrightarrow{t_{1/2,D}}E
\]

\subsection*{Geometry}
The geometry and material and transport parameters are the same as in test 12.


\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Substances:} 5 substances to be transported -- A, B, C, D, E
  \item Polynomial degree of the nominator and the denominator of Pade approximation is~3.
  \item \textbf{Decay half-lives:} 
    \begin{tabular}[c]{|c|c|c|c|}
      \hline
      $t_{1/2,A}$ & $t_{1/2,B}$  & $t_{1/2,C}$ & $t_{1/2,D}$\\[4pt]
      $1.3863$ & $2.3105$ & $1.5403$ & $1.1552$\\[4pt]
      \hline
    \end{tabular}
\end{itemize}

\subsection*{Verification}


=====================  PREPARING  ====================
\section{Test 20 -- Dirichlet boundary condition}
\label{sec:test20}
This test involves steady Darcy flow in 3D determined by Dirichlet boundary condition. The analytic solution is prescribed $u = xyz$. We can see from the formula that there are no sources $-\Lapl{}u = 0$ (zero right hand side) and we can easily define Dirichlet boundary conditions on the sides of the cube just by evaluating the solution there.

\subsection*{Geometry}
The domain is a cube with its side 1.0~$L$ long.
Dirichlet boundary conditions are summarized in the following table. Physical domains corresponds with the numbers in \verb0geo0 file, the row \emph{plane} contains equations of the planes (sides of the cube). The row \emph{Dirichlet} contains solution on the planes. The row \emph{boundary} segment contains numbers of segments defined in \verb0con0 file.

\begin{center}
  \begin{tabular}{|l|c|c|c|c|c|c|}
      \hline
      boundary segment & 1 & 2 & 3 & 4 & 5 & 6 \\ 
      physical domain & 27 & 28 & 29 & 30 & 31 & 32 \\ 
      plane & $z-1=0$  & $x-1=0$ & $z=0$ & $x=0$ & $y-1=0$& $y=0$\\
      Dirichlet [$u_D$] & $xy$ & $yz$ & $0$ & $0$ & $xz$ & $0$\\
      \hline
  \end{tabular}
\end{center}

\subsection*{Parameters}
\begin{itemize}
  \item \textbf{Conductivity:} cube material is set to $\mathbf{K}=\left(\begin{array}{ccc} 1.0 & 0 & 0 \\ 0 & 1.0 & 0 \\ 0 & 0 & 1.0\end{array} \right)$.
  \item There is no transport so there are not any other parameters.
\end{itemize}

\subsection*{Verification}
This test verifies prescribing Dirichlet boundary condition.


\section{Test 21 -- Neumann boundary condition}
\label{sec:test21}
This test uses the same geometry and parameters as in the test 20 (viz~\ref{sec:test20}) but there are prescribed both Dirichlet and Neumann boundary conditions. 

The table of the boundary conditions is below. The row \emph{Dirichlet} contains contains solution on the planes and the row \emph{Neumann} contains flow through the planes.

\begin{center}
  \begin{tabular}{|l|c|c|c|c|c|c|}
      \hline
      boundary segment & 1 & 2 & 3 & 4 & 5 & 6 \\ 
      physical domain & 27 & 28 & 29 & 30 & 31 & 32 \\ 
      plane & $z-1=0$  & $x-1=0$ & $z=0$ & $x=0$ & $y-1=0$& $y=0$\\
      Dirichlet [$u_D$] 
	  &   -   & $yz$ & $0$ & $0$ &   -   & $0$\\
      Neumann [$-\nabla{}u\cdot{}\mathbf{n}$] 
	  & $-xy$ &   -  &  -  &  -  & $-xz$ & - \\
      \hline
  \end{tabular}
\end{center}

\subsection*{Verification}
This test verifies prescribing Neumann boundary condition.

\section{Test 22 -- Newton boundary condition}
\label{sec:test21}
This test uses the same geometry and parameters as in the test 20 (viz~\ref{sec:test20}) but there is prescribed Newton boundary condition $-\nabla{}u\cdot{}\mathbf{n} = \sigma(u-u_T)$.

The table of the boundary conditions where parameters $\sigma$ and $u_T$ are written is below. The values of parameters were chosen to satisfy condition $-\nabla{}u\cdot{}\mathbf{n} = -(yz,xz,xy)\cdot\mathbf{n} = \sigma(u-u_T)$

\begin{center}
  \begin{tabular}{|l|c|c|c|c|c|c|}
      \hline
      boundary segment & 1 & 2 & 3 & 4 & 5 & 6 \\ 
      physical domain & 27 & 28 & 29 & 30 & 31 & 32 \\ 
      plane & $z-1=0$  & $x-1=0$ & $z=0$ & $x=0$ & $y-1=0$& $y=0$\\
      $-\nabla{}u\cdot{}\mathbf{n}$ & $-xy$ & $-yz$ & $xy$ & $yz$ & $-xz$ &\\
      $\sigma$ & $xy$ & $yz$ & $0$ & $0$ & $xz$ & $0$\\
      $u_T$ & $u_T=xy$ & $u=yz$ & $u=0$ & $u=0$ & $u=xz$ & $u=0$\\
      \hline
  \end{tabular}
\end{center}

\subsection*{Verification}
This test verifies prescribing Newton boundary condition.
